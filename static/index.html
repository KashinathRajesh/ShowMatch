<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeCheck</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen p-4 font-sans">
    <header class="max-w-4xl mx-auto text-center py-10">
        <h1 class="text-6xl font-black bg-gradient-to-r from-violet-400 to-fuchsia-500 bg-clip-text text-transparent italic">VIBECHECK</h1>
    </header>

    <main class="max-w-5xl mx-auto">
        <div class="max-w-4xl mx-auto mb-8 bg-slate-900/50 p-6 rounded-3xl border border-slate-800 grid grid-cols-2 md:grid-cols-5 gap-4 text-[10px] font-bold uppercase tracking-widest text-slate-500">
            <div>
                <label class="block mb-2">Count: <span id="limitVal" class="text-violet-400">6</span></label>
                <input type="range" id="limit" min="1" max="12" value="6" oninput="document.getElementById('limitVal').innerText = this.value" class="w-full accent-violet-500">
            </div>
            <div>
                <label class="block mb-2">Rating: <span id="rateVal" class="text-violet-400">0</span></label>
                <input type="range" id="min_rating" min="0" max="9" step="0.5" value="0" oninput="document.getElementById('rateVal').innerText = this.value" class="w-full accent-violet-500">
            </div>
            <div>
                <label class="block mb-2">Platform</label>
                <select id="platform" class="w-full bg-slate-950 border border-slate-800 rounded p-1 text-violet-400 outline-none">
                    <option value="All">All</option>
                    <option value="Netflix">Netflix</option>
                    <option value="Amazon Prime Video">Prime</option>
                    <option value="Disney Plus">Disney+</option>
                    <option value="Apple TV">Apple TV</option>
                </select>
            </div>
            <div class="flex items-center gap-2"><input type="checkbox" id="animation" checked class="w-4 h-4 rounded border-slate-800 bg-slate-950 text-violet-600"><label for="animation">Animation</label></div>
            <div class="flex items-center gap-2"><input type="checkbox" id="adult" class="w-4 h-4 rounded border-slate-800 bg-slate-950 text-violet-600"><label for="adult">18+</label></div>
        </div>

        <div class="relative max-w-2xl mx-auto">
            <div class="flex items-center bg-slate-900 border border-slate-800 rounded-2xl p-2 focus-within:ring-2 ring-violet-500 transition-all">
                <input id="showInput" type="text" oninput="showSuggestions()" placeholder="Search show..." class="flex-1 bg-transparent p-4 outline-none text-lg">
                <button onclick="getRecs()" class="bg-violet-600 hover:bg-violet-500 px-8 py-4 rounded-xl font-bold transition">Find</button>
            </div>
            <div id="suggestionBox" class="absolute w-full bg-slate-900 mt-2 rounded-xl shadow-2xl z-50 hidden border border-slate-800 overflow-hidden"></div>
        </div>
        <div id="results" class="mt-12"></div>
    </main>

    <div id="modal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 max-w-3xl w-full rounded-3xl overflow-hidden border border-slate-800 flex flex-col md:flex-row relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-white bg-black/50 w-10 h-10 rounded-full">✕</button>
            <img id="modalPoster" src="" class="w-full md:w-72 object-cover">
            <div class="p-8 flex flex-col">
                <h2 id="modalTitle" class="text-4xl font-black mb-2 uppercase italic"></h2>
                <p id="modalRating" class="text-violet-400 font-mono text-xs mb-4"></p>
                <p id="modalDesc" class="text-slate-400 text-sm leading-relaxed mb-6"></p>
                <div id="modalProviders"></div>
            </div>
        </div>
    </div>

    <script>
        async function showSuggestions() {
            const q = document.getElementById('showInput').value;
            const box = document.getElementById('suggestionBox');
            if (q.length < 2) { box.classList.add('hidden'); return; }
            const res = await fetch(`http://127.0.0.1:8000/suggest?q=${encodeURIComponent(q)}`);
            const suggestions = await res.json();
            if (suggestions.length > 0) {
                box.innerHTML = suggestions.map(s => `<div class="p-4 hover:bg-slate-800 cursor-pointer border-b border-slate-800" onclick="selectSuggestion('${s.replace(/'/g, "\\'")}')">${s}</div>`).join('');
                box.classList.remove('hidden');
            } else box.classList.add('hidden');
        }
        function selectSuggestion(val) { document.getElementById('showInput').value = val; document.getElementById('suggestionBox').classList.add('hidden'); getRecs(); }
        async function getRecs() {
            const title = document.getElementById('showInput').value;
            const resDiv = document.getElementById('results');
            resDiv.innerHTML = `<div class="flex justify-center py-20"><div class="animate-spin h-10 w-10 border-2 border-violet-500 border-t-transparent rounded-full"></div></div>`;
            const url = `http://127.0.0.1:8000/recommend?title=${encodeURIComponent(title)}&limit=${document.getElementById('limit').value}&min_rating=${document.getElementById('min_rating').value}&include_animation=${document.getElementById('animation').checked}&adult=${document.getElementById('adult').checked}&platform=${encodeURIComponent(document.getElementById('platform').value)}`;
            const res = await fetch(url); const data = await res.json();
            if (data.error) { resDiv.innerHTML = `<p class="text-center text-red-400">${data.error}</p>`; return; }
            resDiv.innerHTML = `<div class="grid grid-cols-2 md:grid-cols-4 gap-6">${data.recommendations.map(show => `<div onclick='openModal(${JSON.stringify(show).replace(/'/g, "&#39;")})' class="group cursor-pointer bg-slate-900 rounded-3xl overflow-hidden border border-slate-800 hover:border-violet-500 transition-all"><img src="${show.poster || 'https://via.placeholder.com/500x750'}" class="w-full aspect-[2/3] object-cover"><div class="p-4"><h3 class="font-bold text-xs truncate uppercase">${show.title}</h3><p class="text-[10px] text-slate-500 mt-1">⭐ ${show.rating}</p></div></div>`).join('')}</div>`;
        }
        function openModal(show) {
            document.getElementById('modalTitle').innerText = show.title;
            document.getElementById('modalPoster').src = show.poster;
            document.getElementById('modalRating').innerText = `CRITIC RATING: ${show.rating}/10`;
            document.getElementById('modalDesc').innerText = show.description;
            const prov = document.getElementById('modalProviders');
            prov.innerHTML = show.stream_on.length > 0 ? `<p class="text-[10px] font-bold text-slate-500 uppercase mb-2">Available on</p><div class="flex flex-wrap gap-2">${show.stream_on.map(p => `<span class="bg-violet-600/20 px-3 py-1 rounded-full text-[10px] font-bold border border-violet-500/30 text-violet-300">${p}</span>`).join('')}</div>` : `<p class="text-xs text-slate-600">No local stream info.</p>`;
            document.getElementById('modal').classList.remove('hidden');
        }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
    </script>
</body>
</html>